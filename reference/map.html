<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Provides five types of map that fit in different use cases."><title>Create R object map. — map • dipsaus</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create R object map. — map"><meta property="og:description" content="Provides five types of map that fit in different use cases."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dipsaus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/r_expr_addons.html">R Expression Add-on</a>
    <a class="dropdown-item" href="../articles/shiny_customized_widgets.html">Shiny Customized Widgets</a>
    <a class="dropdown-item" href="../articles/utility_functions.html">Utility Functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dipterix/dipsaus/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create R object map.</h1>
      <small class="dont-index">Source: <a href="https://github.com/dipterix/dipsaus/blob/HEAD/R/map-s3.R" class="external-link"><code>R/map-s3.R</code></a></small>
      <div class="d-none name"><code>map.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Provides five types of map that fit in different use cases.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">session_map</span><span class="op">(</span>map <span class="op">=</span> <span class="fu">fastmap</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/fastmap/reference/fastmap.html" class="external-link">fastmap</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">rds_map</span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">text_map</span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>map</dt>
<dd><p>a <code><a href="https://r-lib.github.io/fastmap/reference/fastmap.html" class="external-link">fastmap::fastmap()</a></code> list</p></dd>


<dt>path</dt>
<dd><p>directory path where map data should be stored</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An <code>R6</code> instance that inherits <code><a href="AbstractMap.html">AbstractMap</a></code></p>


    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>There are five types of map implemented. They all inherit class
<code><a href="AbstractMap.html">AbstractMap</a></code>. There are several differences in
use case scenarios and they backend implementations.</p>
<dl><dt><code>session_map</code></dt>
<dd><p>A session map takes a <code><a href="https://r-lib.github.io/fastmap/reference/fastmap.html" class="external-link">fastmap</a></code> object. All objects are
stored in current R session. This means you cannot access the map from other
process nor parent process. The goal of this map is to share the data across
different environments and to store global variables, as long as they share
the same map object. If you are looking for maps that can be shared
by different processes, check the rest map types. The closest map type is
<code>rds_map</code>.</p></dd>

<dt><code>rds_map</code></dt>
<dd><p>An 'RDS' map uses file system to store values. The values are stored
separately in '.rds' files. Compared to session maps, 'RDS' map can be
shared across different R process. It's recommended to store
large files in <code>rds_map</code>. If the value is not large in RAM,
<code>text_map</code> is recommended.</p></dd>

<dt><code>text_map</code></dt>
<dd><p>A 'text' map uses file system to store values. Similar to <code>rds_map</code>,
it can be stored across multiple processes as long as the maps share the
same file directory. However, unlike <code>rds_map</code>, <code>text_map</code>
the <code>text_map</code> can only store basic data values, namely atom data types.
The supported types are: numeric, character, vector, list, matrix
It's highly recommended to convert factors to characters. Do NOT use if the
values are functions or environments. The recommended use case scenario
is when the speed is not the major concern, and you want to preserve data
with backward compatibility. Otherwise it's highly recommended to use
<code>rds_map</code>.</p></dd>


</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># ----------------------Basic Usage ----------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define a path to your map.</span></span></span>
<span class="r-in"><span><span class="va">path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">rds_map</span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reset</span></span></span>
<span class="r-in"><span><span class="va">map</span><span class="op">$</span><span class="fu">reset</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check if the map is corrupted.</span></span></span>
<span class="r-in"><span><span class="va">map</span><span class="op">$</span><span class="fu">validate</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You have not set any key-value pairs yet.</span></span></span>
<span class="r-in"><span><span class="co"># Let's say two parallel processes (A and B) are sharing this map.</span></span></span>
<span class="r-in"><span><span class="co"># Process A set values</span></span></span>
<span class="r-in"><span><span class="va">map</span><span class="op">$</span><span class="fu">keys</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Start push</span></span></span>
<span class="r-in"><span><span class="co"># set a normal message</span></span></span>
<span class="r-in"><span><span class="va">map</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>key <span class="op">=</span> <span class="st">'a'</span>, value <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set a large object</span></span></span>
<span class="r-in"><span><span class="va">map</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>key <span class="op">=</span> <span class="st">'b'</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100000</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set an object with hash of another object</span></span></span>
<span class="r-in"><span><span class="va">map</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>key <span class="op">=</span> <span class="st">'c'</span>, value <span class="op">=</span> <span class="fl">2</span>, signature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  parameter1 <span class="op">=</span> <span class="fl">123</span>,</span></span>
<span class="r-in"><span>  parameter2 <span class="op">=</span> <span class="fl">124</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check what's in the map from process B</span></span></span>
<span class="r-in"><span><span class="va">mapB</span> <span class="op">&lt;-</span> <span class="fu">rds_map</span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mapB</span><span class="op">$</span><span class="fu">keys</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ==YQ ==Yg ==Yw </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  "a"  "b"  "c" </span>
<span class="r-in"><span><span class="va">mapB</span><span class="op">$</span><span class="fu">keys</span><span class="op">(</span>include_signatures <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      keys                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ==YQ "a"  "6717f2823d3202449301145073ab8719"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ==Yg "b"  "47603c6eb8fc74469c9f034d74fbe021"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ==Yw "c"  "f3b07dfebb13e24c3b1a5e11ec21a15d"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Number of key-values pairs in the map.</span></span></span>
<span class="r-in"><span><span class="va">mapB</span><span class="op">$</span><span class="fu">size</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check if key exists</span></span></span>
<span class="r-in"><span><span class="va">mapB</span><span class="op">$</span><span class="fu">has</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span>,<span class="st">'a'</span>, <span class="st">'c'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1     a     c </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FALSE  TRUE  TRUE </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check if key exists and signature also matches</span></span></span>
<span class="r-in"><span><span class="va">mapB</span><span class="op">$</span><span class="fu">has</span><span class="op">(</span><span class="st">'c'</span>, signature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  parameter1 <span class="op">=</span> <span class="fl">123</span>,</span></span>
<span class="r-in"><span>  parameter2 <span class="op">=</span> <span class="fl">124</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    c </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> TRUE </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Signature changed, then return FALSE. This is especially useful when</span></span></span>
<span class="r-in"><span><span class="co"># value is really large and reading the value takes tons of time</span></span></span>
<span class="r-in"><span><span class="va">mapB</span><span class="op">$</span><span class="fu">has</span><span class="op">(</span><span class="st">'c'</span>, signature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  parameter1 <span class="op">=</span> <span class="fl">1244444</span>,</span></span>
<span class="r-in"><span>  parameter2 <span class="op">=</span> <span class="fl">124</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     c </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FALSE </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Destroy the map's files altogether.</span></span></span>
<span class="r-in"><span><span class="va">mapB</span><span class="op">$</span><span class="fu">destroy</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># Once destroyed, validate will raise error</span></span></span>
<span class="r-in"><span>  <span class="va">mapB</span><span class="op">$</span><span class="fu">validate</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhengjia Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

