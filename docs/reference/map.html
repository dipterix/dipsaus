<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create R object map. — map • dipsaus</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Create R object map. — map" />
<meta property="og:description" content="Provides five types of map that fit in different use cases." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dipsaus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/async_evaluator.html">Asynchronous Evaluator</a>
    </li>
    <li>
      <a href="../articles/r_expr_addons.html">R Expression Add-on</a>
    </li>
    <li>
      <a href="../articles/shiny_customized_widgets.html">Shiny Customized Widgets</a>
    </li>
    <li>
      <a href="../articles/utility_functions.html">Utility Functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dipterix/dipsaus/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create R object map.</h1>
    <small class="dont-index">Source: <a href='https://github.com/dipterix/dipsaus/blob/master/R/map-s3.R'><code>R/map-s3.R</code></a></small>
    <div class="hidden name"><code>map.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Provides five types of map that fit in different use cases.</p>
    </div>

    <pre class="usage"><span class='fu'>session_map</span>(<span class='kw'>map</span> <span class='kw'>=</span> <span class='kw pkg'>fastmap</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/fastmap/man/fastmap.html'>fastmap</a></span>())

<span class='fu'>rds_map</span>(<span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span>())

<span class='fu'>text_map</span>(<span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span>())

<span class='fu'>qs_map</span>(<span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span>())

<span class='fu'>redis_map</span>(<span class='kw'>name</span> <span class='kw'>=</span> <span class='fu'>rand_string</span>())</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>map</th>
      <td><p>a <code><a href='https://rdrr.io/pkg/fastmap/man/fastmap.html'>fastmap::fastmap()</a></code> list</p></td>
    </tr>
    <tr>
      <th>path</th>
      <td><p>directory path where map data should be stored</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>character, map name. If map names are the same, the data
will be shared.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An <code>R6</code> instance that inherits <code><a href='AbstractMap.html'>AbstractMap</a></code></p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>There are five types of map implemented. They all inherit class
<code><a href='AbstractMap.html'>AbstractMap</a></code>. There are several differences in
use case scenarios and they backend implementations.</p>
<dl'>
<dt><code>session_map</code></dt><dd><p>A session map takes a <code><a href='https://rdrr.io/pkg/fastmap/man/fastmap.html'>fastmap</a></code> object. All objects are
stored in current R session. This means you cannot access the map from other
process nor parent process. The goal of this map is to share the data across
different environments and to store global variables, as long as they share
the same map object. If you are looking for maps that can be shared
by different processes, check the rest map types. The closest map type is
<code>redis_map</code>, which is also memory-based.</p></dd>
<dt><code>rds_map</code></dt><dd><p>An 'RDS' map uses file system to store values. The values are stored
separately in '.rds' files. Compared to session maps, 'RDS' map can be
shared across different R process. It's recommended to store
large files in <code>rds_map</code>. If the value is not large in RAM,
<code>text_map</code> and <code>redis_map</code> are recommended.</p></dd>
<dt><code>qs_map</code></dt><dd><p>A 'qs' map uses package 'qs' as backend. This map is very similar to
<code>rds_map</code>, but is especially designed for large values. For example,
pushing 1GB data to <code>qs_map</code> will be 100 times faster than using
<code>rds_map</code>, and <code>text_map</code> will almost fail. However, compared
to <code>rds_map</code> the stored data cannot be normally read by R as they
are compressed binary files. And <code>qs_map</code> is heavier than
<code>text_map</code>.</p></dd>
<dt><code>text_map</code></dt><dd><p>A 'text' map uses file system to store values. Similar to <code>rds_map</code>,
it can be stored across multiple processes as long as the maps share the
same file directory. However, unlike <code>rds_map</code>, <code>text_map</code>
the <code>text_map</code> can only store basic data values, namely atom data types.
The supported types are: numeric, character, vector, list, matrix
It's highly recommended to convert factors to characters. Do NOT use if the
values are functions or environments. Please check
<code><a href='https://rdrr.io/pkg/yaml/man/write_yaml.html'>write_yaml</a></code> for details. The recommended use case scenario
is when the speed is not the major concern, and you want to preserve data
with backward compatibility. Otherwise it's highly recommended to use
<code>redis_map</code>, <code>qs_map</code>, and <code>rds_map</code>.</p></dd>
<dt><code>redis_map</code></dt><dd><p>A 'Redis' map uses free open source software `Redis` and R package
'RcppRedis' as backend. Compared to session map, 'Redis' map can be
shared across sessions. Compared to 'text' and 'rds' maps, 'Redis' map
stores data in memory, meaning a potential of significant speed ups. To use
<code>redis_map</code>, you need to install `Redis` on your computer.
<ul>
<li><p>On Mac: use `<code>brew install redis</code>` to install and
    `<code>brew services start redis</code>` to start the service</p></li>
<li><p>On Linux: use `<code>sudo apt-get install redis-server</code>` to install
    and `<code>sudo systemctl enable redis-server.service</code>` to start the
    service</p></li>
<li><p>On Windows: Download from
    <a href='https://github.com/dmajkic/redis/downloads'>https://github.com/dmajkic/redis/downloads</a> and double click
    'redis-server.exe'</p></li>
</ul></p></dd>

</dl>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># ----------------------Basic Usage ----------------------</span>

<span class='co'># Define a path to your map.</span>
<span class='no'>path</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span>()
<span class='no'>map</span> <span class='kw'>&lt;-</span> <span class='fu'>qs_map</span>(<span class='no'>path</span>)

<span class='co'># Reset</span>
<span class='no'>map</span>$<span class='fu'>reset</span>()

<span class='co'># Check if the map is corrupted.</span>
<span class='no'>map</span>$<span class='fu'>validate</span>()

<span class='co'># You have not set any key-value pairs yet.</span>
<span class='co'># Let's say two parallel processes (A and B) are sharing this map.</span>
<span class='co'># Process A set values</span>
<span class='no'>map</span>$<span class='fu'>keys</span>()</div><div class='output co'>#&gt; NULL</div><div class='input'>
<span class='co'># Start push</span>
<span class='co'># set a normal message</span>
<span class='no'>map</span>$<span class='fu'>set</span>(<span class='kw'>key</span> <span class='kw'>=</span> <span class='st'>'a'</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='fl'>1</span>)

<span class='co'># set a large object</span>
<span class='no'>map</span>$<span class='fu'>set</span>(<span class='kw'>key</span> <span class='kw'>=</span> <span class='st'>'b'</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fl'>100000</span>))

<span class='co'># set an object with hash of another object</span>
<span class='no'>map</span>$<span class='fu'>set</span>(<span class='kw'>key</span> <span class='kw'>=</span> <span class='st'>'c'</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>signature</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='kw'>parameter1</span> <span class='kw'>=</span> <span class='fl'>123</span>,
  <span class='kw'>parameter2</span> <span class='kw'>=</span> <span class='fl'>124</span>
))

<span class='co'># Check what's in the map from process B</span>
<span class='no'>mapB</span> <span class='kw'>&lt;-</span> <span class='fu'>qs_map</span>(<span class='no'>path</span>)
<span class='no'>mapB</span>$<span class='fu'>keys</span>()</div><div class='output co'>#&gt; ==YQ ==Yg ==Yw 
#&gt;  "a"  "b"  "c" </div><div class='input'><span class='no'>mapB</span>$<span class='fu'>keys</span>(<span class='kw'>include_signatures</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt;      keys                                   
#&gt; ==YQ "a"  "6717f2823d3202449301145073ab8719"
#&gt; ==Yg "b"  "ccbaa6726fd79ecdc62206d33eed8109"
#&gt; ==Yw "c"  "f3b07dfebb13e24c3b1a5e11ec21a15d"</div><div class='input'>
<span class='co'># Number of key-values pairs in the map.</span>
<span class='no'>mapB</span>$<span class='fu'>size</span>()</div><div class='output co'>#&gt; [1] 3</div><div class='input'>
<span class='co'># Check if key exists</span>
<span class='no'>mapB</span>$<span class='fu'>has</span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'1'</span>,<span class='st'>'a'</span>, <span class='st'>'c'</span>))</div><div class='output co'>#&gt;     1     a     c 
#&gt; FALSE  TRUE  TRUE </div><div class='input'>
<span class='co'># Check if key exists and signature also matches</span>
<span class='no'>mapB</span>$<span class='fu'>has</span>(<span class='st'>'c'</span>, <span class='kw'>signature</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='kw'>parameter1</span> <span class='kw'>=</span> <span class='fl'>123</span>,
  <span class='kw'>parameter2</span> <span class='kw'>=</span> <span class='fl'>124</span>
))</div><div class='output co'>#&gt;    c 
#&gt; TRUE </div><div class='input'>
<span class='co'># Signature changed, then return FALSE. This is especially useful when</span>
<span class='co'># value is really large and reading the value takes tons of time</span>
<span class='no'>mapB</span>$<span class='fu'>has</span>(<span class='st'>'c'</span>, <span class='kw'>signature</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='kw'>parameter1</span> <span class='kw'>=</span> <span class='fl'>1244444</span>,
  <span class='kw'>parameter2</span> <span class='kw'>=</span> <span class='fl'>124</span>
))</div><div class='output co'>#&gt;     c 
#&gt; FALSE </div><div class='input'>
<span class='co'># Destroy the map's files altogether.</span>
<span class='no'>mapB</span>$<span class='fu'>destroy</span>()

<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
  <span class='co'># Once destroyed, validate will raise error</span>
  <span class='no'>mapB</span>$<span class='fu'>validate</span>()
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Zhengjia Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


