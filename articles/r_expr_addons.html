<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dipsaus">
<title>R Expression Add-on â€¢ dipsaus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="R Expression Add-on">
<meta property="og:description" content="dipsaus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dipsaus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.8.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/r_expr_addons.html">R Expression Add-on</a>
    <a class="dropdown-item" href="../articles/shiny_customized_widgets.html">Shiny Customized Widgets</a>
    <a class="dropdown-item" href="../articles/utility_functions.html">Utility Functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dipterix/dipsaus/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>R Expression Add-on</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dipterix/dipsaus/blob/HEAD/vignettes/r_expr_addons.Rmd" class="external-link"><code>vignettes/r_expr_addons.Rmd</code></a></small>
      <div class="d-none name"><code>r_expr_addons.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="assign-if-invalid">1. <code>%?&lt;-%</code>: Assign if invalid<a class="anchor" aria-label="anchor" href="#assign-if-invalid"></a>
</h3>
<p>When coding in R, the data checking is actually a headache. For
example, to check if a variable <code>aa</code> exists and not
<code>NULL</code>, otherwise set a default value to be 1, the check
looks like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">'aa'</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">aa</span><span class="op">)</span> <span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">aa</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Most of time we are repeating ourselves. With <code>%?&lt;-%</code>
operator, we just need:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aa</span> <span class="op"><a href="../reference/grapes-help-set-grapes.html">%?&lt;-%</a></span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">aa</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>The powerful part is the left-hand side can be any expression. For
example,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l</span> <span class="op"><a href="../reference/grapes-help-set-grapes.html">%?&lt;-%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">l</span><span class="op">$</span><span class="va">aa</span> <span class="op"><a href="../reference/grapes-help-set-grapes.html">%?&lt;-%</a></span> <span class="fl">1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span></span>
<span><span class="co">#&gt; $aa</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>If the value exists, then <code>%?&lt;-%</code> does nothing (not
even evaluate the expressions on the right-hand side)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># e already exists</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>aa <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># %?&lt;-% will not evaluate rhs, nor assign values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">e</span> <span class="op"><a href="../reference/grapes-help-set-grapes.html">%?&lt;-%</a></span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>aa <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; $aa</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.000   0.001   0.000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="javascript-style-of-creating-functions">2. JavaScript-style of creating functions<a class="anchor" aria-label="anchor" href="#javascript-style-of-creating-functions"></a>
</h3>
<p>In modern JavaScript, function can be created via
<code>(arg) =&gt; { ... }</code>. For example,</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> li <span class="op">=</span> [<span class="st">'A'</span><span class="op">,</span> <span class="st">'T'</span><span class="op">,</span> <span class="st">'G'</span><span class="op">,</span> <span class="st">'C'</span>]<span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>li<span class="op">.</span><span class="fu">map</span>((el<span class="op">,</span> ii) <span class="kw">=&gt;</span> {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span>(<span class="vs">`The index for </span><span class="sc">${</span>el<span class="sc">}</span><span class="vs"> is </span><span class="sc">${</span>ii<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<script>
const li = ['A', 'T', 'G', 'C'];
li.map((el, ii) => {
  return(`The index for ${el} is ${ii}`);
});
</script><p><code>dipsaus</code> provides functions <code>iapply</code>, and
<code>%=&gt;%</code>, together with <code>glue</code> package, we can
apply elements like this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gl &lt;- glue::glue</span></span>
<span><span class="co"># `%&gt;%` &lt;- magrittr::`%&gt;%`</span></span>
<span></span>
<span><span class="va">li</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">'T'</span>, <span class="st">'G'</span>, <span class="st">'C'</span><span class="op">)</span></span>
<span><span class="va">li</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/iapply.html">iapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">el</span>, <span class="va">ii</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-equals-greater-than-grapes.html">%=&gt;%</a></span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/gl.html" class="external-link">gl</a></span><span class="op">(</span><span class="st">'The index for {el} is {ii}'</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The index for A is 1" "The index for T is 2" "The index for G is 3"</span></span>
<span><span class="co">#&gt; [4] "The index for C is 4"</span></span></code></pre></div>
<p><code>%=&gt;%</code> collect the left-hand side elements as arguments
and right-hand side expression as body and create function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a</span>, b<span class="op">=</span><span class="va">a</span><span class="op">^</span><span class="fl">2</span>, <span class="va">...</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-equals-greater-than-grapes.html">%=&gt;%</a></span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a</span> , <span class="va">b</span>,<span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; function (a, b = a^2, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     print(c(a, b, ...))</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="match-nested-calls-match_calls">3. Match nested calls <code>match_calls</code><a class="anchor" aria-label="anchor" href="#match-nested-calls-match_calls"></a>
</h3>
<p>The function <code>match.call</code> provided by base package let us
format calls with formals matched.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/match.call.html" class="external-link">match.call</a></span><span class="op">(</span><span class="va">textInput</span>, call <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html" class="external-link">textInput</a></span><span class="op">(</span><span class="st">'inputId'</span>, <span class="st">'label'</span>, <span class="st">'aaa'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; textInput(inputId = "inputId", label = "label", value = "aaa")</span></span></code></pre></div>
<p>This is already powerful as we can parse the expressions using
<code><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list()</a></code> to get the input parameters. However, when
encounter the nested calls like <code>shiny</code> UI components,
<code>match.call</code> does not work well. We canâ€™t see the matched
results inside of the nested functions.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/match.call.html" class="external-link">match.call</a></span><span class="op">(</span><span class="va">tagList</span>, call <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">div</a></span><span class="op">(</span></span>
<span>    <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html" class="external-link">textInput</a></span><span class="op">(</span><span class="st">'inputId'</span>, <span class="st">'label'</span>, <span class="st">'aaa'</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; tagList(div(tags$ul(tags$li(textInput("inputId", "label", "aaa")))))</span></span></code></pre></div>
<p><code>match_calls</code> solves this problem by recursively calling
<code>match.call</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/match_calls.html">match_calls</a></span><span class="op">(</span>call <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">div</a></span><span class="op">(</span></span>
<span>    <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html" class="external-link">textInput</a></span><span class="op">(</span><span class="st">'inputId'</span>, <span class="st">'label'</span>, <span class="st">'aaa'</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; tagList(div(tags$ul(tags$li(textInput(inputId = "inputId", label = "label", </span></span>
<span><span class="co">#&gt;     value = "aaa")))))</span></span></code></pre></div>
<p>It can also change modify the calls. For example, we want to add
<code>ns</code> to input ID in shiny modules, then the following
<code>replave_args</code> changes <code>"inputId"</code> to
<code>ns("inputId")</code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/match_calls.html">match_calls</a></span><span class="op">(</span>call <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">div</a></span><span class="op">(</span></span>
<span>    <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html" class="external-link">textInput</a></span><span class="op">(</span><span class="st">'inputId'</span>, <span class="st">'label'</span>, <span class="st">'aaa'</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, replace_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">'inputId'</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">v</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">ns</span><span class="op">)</span>, <span class="va">v</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; tagList(div(tags$ul(tags$li(textInput(inputId = ns("inputId"), </span></span>
<span><span class="co">#&gt;     label = "label", value = "aaa")))))</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pipe-friendly-functions">4. Pipe-friendly functions<a class="anchor" aria-label="anchor" href="#pipe-friendly-functions"></a>
</h3>
<p>Pipe functions can simplify the workflow and make R code more
readable. The most popular pipe <code>%&gt;%</code> allows the left-hand
elements to be the first input of the right-hand side functions.
<code>dipsaus</code> provides several pipe-friendly functions.</p>
<div class="section level4">
<h4 id="no-operations-no_op">No-operations <code>no_op</code><a class="anchor" aria-label="anchor" href="#no-operations-no_op"></a>
</h4>
<p><code>no_op</code> takes whatever input in, and returns the input,
with side effects. For example, we want to plot the results from the
pipe and continue the analysis, usually this is what happens:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">do_something</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">x_tmp</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x_tmp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_tmp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">do_others</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">final_results</span></span></code></pre></div>
<p>With <code>no_op</code>, the pipe becomes:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">do_something</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/no_op.html">no_op</a></span><span class="op">(</span><span class="va">plot</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">do_others</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">final_results</span></span></code></pre></div>
<p>Hereâ€™s an example</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/iapply.html">iapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">el</span>, <span class="va">ii</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-equals-greater-than-grapes.html">%=&gt;%</a></span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, <span class="va">el</span>, <span class="va">ii</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">unlist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># Begin no-ops, result will not change</span></span>
<span>  <span class="fu"><a href="../reference/no_op.html">no_op</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># Use expression and "." to refer the data</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/no_op.html">no_op</a></span><span class="op">(</span></span>
<span>    <span class="co"># Use function and pass ... to function</span></span>
<span>    <span class="va">plot</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>, </span>
<span>    type <span class="op">=</span> <span class="st">'p'</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>,<span class="fl">20</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Time'</span>, ylab <span class="op">=</span> <span class="st">'Value'</span>, las <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/no_op.html">no_op</a></span><span class="op">(</span><span class="va">hist</span>, xlab <span class="op">=</span> <span class="st">'Values'</span>, main <span class="op">=</span> <span class="st">'Histogram'</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">result</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt; -11.095   0.691   3.276   4.481   7.879  22.539</span></span></code></pre></div>
<p><img src="r_expr_addons_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt;  num [1:200] 0.424 0.771 1.148 0.823 0.75 ...</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="do_aggregate">
<code>do_aggregate</code><a class="anchor" aria-label="anchor" href="#do_aggregate"></a>
</h4>
<p>This is a wrapper of <code>aggregate</code> function. When using
formula, <code>aggregate</code> requires the formula to be the first
element. If the pipe results are <code>data.frame</code> and we want to
use formula, itâ€™s super inconvenient.</p>
<pre><code><span><span class="co">## S3 method for class 'formula'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">FUN</span>, <span class="va">...</span>, <span class="va">subset</span>, na.action <span class="op">=</span> <span class="va">na.omit</span><span class="op">)</span></span></code></pre>
<p><code>do_aggregate</code> allows the first element to be data frames
while using formula:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ToothGrowth</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/do_aggregate.html">do_aggregate</a></span><span class="op">(</span><span class="va">len</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt;   supp dose   len</span></span>
<span><span class="co">#&gt; 1   OJ  0.5 13.23</span></span>
<span><span class="co">#&gt; 2   VC  0.5  7.98</span></span>
<span><span class="co">#&gt; 3   OJ  1.0 22.70</span></span>
<span><span class="co">#&gt; 4   VC  1.0 16.77</span></span>
<span><span class="co">#&gt; 5   OJ  2.0 26.06</span></span>
<span><span class="co">#&gt; 6   VC  2.0 26.14</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Zhengjia Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
